<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji Matching Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .game-board {
            display: grid;
            gap: 0.5rem; /* Reduced gap for more cards */
            perspective: 1000px;
        }
        /* Grid layouts for different levels */
        .level-1 { grid-template-columns: repeat(4, 1fr); }
        .level-2 { grid-template-columns: repeat(5, 1fr); }
        .level-3 { grid-template-columns: repeat(6, 1fr); }

        .card {
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
            aspect-ratio: 1 / 1;
        }
        .card.is-flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem; /* Smaller radius for smaller cards */
            font-size: clamp(1rem, 8vw, 2.5rem);
        }
        .card-front {
            background-color: #4f46e5; /* Indigo 600 */
        }
        .card-back {
            background-color: #a5b4fc; /* Indigo 300 */
            transform: rotateY(180deg);
        }
        .card.is-matched {
            transform: rotateY(180deg);
            cursor: default;
            opacity: 0.5;
        }
        /* Modal styles */
        #win-modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-800 text-white flex flex-col items-center justify-center min-h-screen p-4">

    <div class="text-center w-full max-w-2xl mx-auto">
        <h1 class="text-4xl font-bold mb-2">Emoji Match</h1>
        <p class="text-gray-400 mb-4">Select a level and find all the matching pairs!</p>

        <!-- Level Selector -->
        <div class="flex justify-center space-x-2 mb-4">
            <button class="level-btn bg-gray-600 hover:bg-gray-500 font-bold py-2 px-4 rounded-lg" data-level="1">Easy (4x4)</button>
            <button class="level-btn bg-gray-600 hover:bg-gray-500 font-bold py-2 px-4 rounded-lg" data-level="2">Medium (5x4)</button>
            <button class="level-btn bg-gray-600 hover:bg-gray-500 font-bold py-2 px-4 rounded-lg" data-level="3">Hard (6x6)</button>
        </div>
        
        <!-- Game Stats -->
        <div class="flex justify-between items-center w-full max-w-sm mx-auto bg-gray-700 rounded-lg p-3 mb-6">
            <div class="text-center">
                <span class="text-lg font-bold" id="moves-counter">0</span>
                <span class="block text-sm text-gray-400">Moves</span>
            </div>
             <div class="text-center">
                <span class="text-lg font-bold" id="timer">0s</span>
                <span class="block text-sm text-gray-400">Time</span>
            </div>
            <button id="reset-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                Reset
            </button>
        </div>

        <!-- Game Board -->
        <div id="game-board" class="game-board w-full max-w-2xl mx-auto">
            <!-- Cards will be generated by JavaScript -->
        </div>
    </div>

    <!-- Win Modal -->
    <div id="win-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div class="modal-content bg-gray-700 rounded-xl shadow-xl p-8 w-full max-w-sm text-center transform scale-95">
            <h2 class="text-3xl font-bold mb-2 text-yellow-400">You Won! 🎉</h2>
            <div class="text-lg text-gray-300 mb-4">
                <p>You finished in <span id="final-time" class="font-bold text-white">0s</span>.</p>
                <p>Total moves: <span id="final-moves" class="font-bold text-white">0</span></p>
            </div>
            <button id="play-again-btn" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors">
                Play Again
            </button>
        </div>
    </div>

    <script>
        // DOM Elements
        const gameBoard = document.getElementById('game-board');
        const movesCounter = document.getElementById('moves-counter');
        const timerDisplay = document.getElementById('timer');
        const resetBtn = document.getElementById('reset-btn');
        const winModal = document.getElementById('win-modal');
        const finalMoves = document.getElementById('final-moves');
        const finalTime = document.getElementById('final-time');
        const playAgainBtn = document.getElementById('play-again-btn');
        const levelButtons = document.querySelectorAll('.level-btn');

        // Game State
        const allEmojis = ['🐶', '🐱', '🐭', '🐹', '🐰', '🦊', '🐻', '🐼', '🐨', '🐯', '🦁', '🐮', '🐷', '🐸', '🐵', '🐔', '🐧', '🐦'];
        let currentEmojis = [];
        let cardDeck = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let moves = 0;
        let lockBoard = false;
        let currentLevel = 1;
        let timerInterval = null;
        let seconds = 0;

        const levelConfig = {
            1: { pairs: 8,  gridClass: 'level-1' }, // 4x4
            2: { pairs: 10, gridClass: 'level-2' }, // 5x4
            3: { pairs: 18, gridClass: 'level-3' }, // 6x6
        };

        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex !== 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }
        
        /**
         * Initializes or resets the game to a specific level.
         * This function handles all setup and state resetting, removing the recursive call.
         */
        function startGame(level) {
            // Stop any ongoing processes and reset all state variables
            hideWinModal();
            stopTimer();
            moves = 0;
            seconds = 0;
            matchedPairs = 0;
            movesCounter.textContent = moves;
            timerDisplay.textContent = `${seconds}s`;
            resetBoardState();

            // Set up the new level
            currentLevel = level;
            const config = levelConfig[level];
            
            // Set active button style
            levelButtons.forEach(btn => {
                btn.classList.remove('bg-indigo-600');
                btn.classList.add('bg-gray-600');
                if (parseInt(btn.dataset.level) === level) {
                    btn.classList.add('bg-indigo-600');
                    btn.classList.remove('bg-gray-600');
                }
            });

            // Prepare emojis for the current level
            currentEmojis = allEmojis.slice(0, config.pairs);
            cardDeck = shuffle([...currentEmojis, ...currentEmojis]);
            
            // Generate the HTML for the game board
            gameBoard.innerHTML = '';
            gameBoard.className = 'game-board w-full max-w-2xl mx-auto'; // Reset classes
            gameBoard.classList.add(config.gridClass);

            cardDeck.forEach(emoji => {
                const card = document.createElement('div');
                card.classList.add('card');
                card.dataset.emoji = emoji;
                card.innerHTML = `
                    <div class="card-face card-front"></div>
                    <div class="card-face card-back">${emoji}</div>
                `;
                card.addEventListener('click', handleCardClick);
                gameBoard.appendChild(card);
            });
        }

        function handleCardClick(event) {
            // Start timer on the first move of the game
            if (!timerInterval && moves === 0) {
                startTimer();
            }
            
            const clickedCard = event.currentTarget;
            if (lockBoard || clickedCard.classList.contains('is-flipped')) {
                return;
            }

            flipCard(clickedCard);

            if (flippedCards.length === 0) {
                flippedCards.push(clickedCard);
            } else {
                flippedCards.push(clickedCard);
                incrementMoves();
                checkForMatch();
            }
        }

        function flipCard(card) {
            card.classList.add('is-flipped');
        }

        function unflipCard(card) {
            card.classList.remove('is-flipped');
        }
        
        function incrementMoves() {
            moves++;
            movesCounter.textContent = moves;
        }
        
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            seconds = 0;
            timerDisplay.textContent = `${seconds}s`;
            timerInterval = setInterval(() => {
                seconds++;
                timerDisplay.textContent = `${seconds}s`;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
        }

        function checkForMatch() {
            lockBoard = true;
            const [cardOne, cardTwo] = flippedCards;

            if (cardOne.dataset.emoji === cardTwo.dataset.emoji) {
                disableMatchedCards();
            } else {
                unflipMismatchedCards();
            }
        }

        function disableMatchedCards() {
            const [cardOne, cardTwo] = flippedCards;
            cardOne.removeEventListener('click', handleCardClick);
            cardTwo.removeEventListener('click', handleCardClick);
            cardOne.classList.add('is-matched');
            cardTwo.classList.add('is-matched');
            
            matchedPairs++;
            resetBoardState();

            if (matchedPairs === levelConfig[currentLevel].pairs) {
                stopTimer();
                setTimeout(showWinModal, 800);
            }
        }

        function unflipMismatchedCards() {
            setTimeout(() => {
                const [cardOne, cardTwo] = flippedCards;
                unflipCard(cardOne);
                unflipCard(cardTwo);
                resetBoardState();
            }, 1000);
        }

        function resetBoardState() {
            flippedCards = [];
            lockBoard = false;
        }
        
        function showWinModal() {
            finalMoves.textContent = moves;
            finalTime.textContent = `${seconds}s`;
            winModal.classList.remove('hidden');
            setTimeout(() => winModal.querySelector('.modal-content').classList.replace('scale-95', 'scale-100'), 10);
        }
        
        function hideWinModal() {
            if (winModal.classList.contains('hidden')) return;
            winModal.querySelector('.modal-content').classList.replace('scale-100', 'scale-95');
            setTimeout(() => winModal.classList.add('hidden'), 300);
        }

        // --- Event Listeners ---
        resetBtn.addEventListener('click', () => startGame(currentLevel));
        playAgainBtn.addEventListener('click', () => startGame(currentLevel));
        
        levelButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                const level = parseInt(e.target.dataset.level);
                startGame(level);
            });
        });

        // --- Initial Setup ---
        window.onload = () => startGame(1);

    </script>
</body>
</html>
